## ARQUITECTURA 3-CAPAS: APP DE GESTIÓN DE EDIFICIOS (ARQUITECTURA CLÁSICA)

Eres un desarrollador fullstack senior especializado en arquitecturas web tradicionales. Debes ayudarme a implementar un sistema de gestión de reservas para edificios usando una arquitectura de 3 capas: Frontend, Backend API y Base de Datos Supabase.

## CONTEXTO


Tengo un frontend React/PWA funcional con interfaces de admin y residente. Necesito agregar un backend API real que se comunique con Supabase como base de datos, implementando autenticación, autorización y reglas de negocio en el servidor.



### FASE 1: EL CORAZÓN (DB & AUTH)

*Objetivo: Tener la base de datos lista y poder loguearnos.*

1. **Prompt - Schema SQL:** "Genera el SQL para crear las tablas `users`, `amenities`, `bookings`, `announcements` y `app_settings` según el esquema definido. No incluyas RLS, ya que la seguridad se manejará en el backend."
2. **Prompt - Express Setup:** "Configura el boilerplate de Express con el cliente de Supabase (usando `SERVICE_ROLE_KEY`) y el middleware de autenticación JWT. Crea el endpoint `POST /api/auth/register` (con bcrypt para el hash) y `POST /api/auth/login`."
3. **Prompt - Auth Middleware:** "Implementa los middlewares `auth.js` (para verificar el JWT) y `roleCheck.js` (para validar si el usuario es 'admin' o 'resident')."

---

### FASE 2: GESTIÓN DE CONTENIDO (CRUD SIMPLE)

*Objetivo: Que el admin pueda cargar la información básica.*

1. **Prompt - Amenities API:** "Crea el CRUD completo para `amenities`. Los residentes solo pueden hacer GET, mientras que solo los admins pueden hacer POST, PUT y DELETE. Usa el middleware `roleCheck`."
2. **Prompt - Announcements API:** "Implementa el sistema de anuncios. Los anuncios deben guardarse con el `author_id` del admin que los crea. Los residentes solo pueden ver los que tienen `is_published: true`."

---

### FASE 3: LÓGICA DE NEGOCIO (RESERVAS)

*Objetivo: La parte más crítica, validar que nadie reserve lo que no puede.*

1. **Prompt - Settings Service:** "Crea un servicio `settings.service.js` para leer valores de la tabla `app_settings`. Esto servirá para validar límites de horas y cantidad de reservas."
2. **Prompt - Booking Validation:** "Implementa la lógica en `booking.service.js` para validar una reserva:
* No debe solaparse con otra confirmada.
* Debe cumplir con las horas de anticipación (de `app_settings`).
* El usuario no debe exceder su límite de reservas activas."


3. **Prompt - Booking Endpoints:** "Crea `POST /api/bookings` usando el servicio de validación anterior y `PUT /api/bookings/:id/cancel` para que los usuarios puedan cancelar sus propias reservas."

---

### FASE 4: INTEGRACIÓN FRONTEND

*Objetivo: Conectar tu React/PWA con esta nueva API.*

1. **Prompt - API Client:** "En el frontend, configura una instancia de Axios que incluya automáticamente el JWT del `localStorage` en el header `Authorization`. Crea las funciones para consumir el login y el listado de amenities."
2. **Prompt - Error Feedback:** "Ajusta el formulario de reservas en el frontend para que capture los errores del backend (ej: 'Horario no disponible') y los muestre en un componente de alerta amigable."
