## ESTRATEGIA: VIBE CODING INCREMENTAL

### FASE 1: MODELO B2B (Aislamiento de Datos)

*El objetivo es que cada edificio/organización viva en su propio mundo.*

1. **Prompt - Schema:** "Crea la tabla `organizations` y migra `users` y `amenities` para incluir un `organization_id`. Asegura que todos los datos actuales se asignen a una organización por defecto 'Edificio Principal'."
2. **Prompt - RLS:** "Configura las políticas RLS en Supabase para que los usuarios **solo** vean datos (usuarios, amenities, bookings) que pertenezcan a su mismo `organization_id`."
3. **Prompt - Invitaciones:** "Implementa un sistema de invitaciones por token: una tabla `organization_invitations` y ajusta el registro para que requiera un token válido antes de crear el usuario."

---

### FASE 2: ANALYTICS LOCAL (Métricas Propias)

*Sin librerías pesadas, solo datos puros.*

1. **Prompt - Event Tracking:** "Crea una tabla `analytics_events` (org_id, user_id, type, metadata JSONB). Crea un servicio en el backend `trackEvent` que se dispare en logins, reservas y cancelaciones."
2. **Prompt - Dashboard Data:** "Crea una Vista Materializada para agrupar reservas y fallos por día. Expón un endpoint `/api/analytics/stats` que devuelva estos datos para los últimos 30 días."
3. **Prompt - Gráfico Minimalista:** "En el frontend, crea un componente de gráfico de líneas usando **Canvas API puro** (sin librerías externas) para mostrar la tendencia de reservas."

---

### FASE 3: NOTIFICACIONES (Resend + Supabase)

*Comunicación transaccional simple.*

1. **Prompt - Setup:** "Configura el cliente de `resend` en el backend y crea una tabla `email_logs` para trackear envíos. Usa variables de entorno para la API Key."
2. **Prompt - Templates & Logic:** "Crea funciones para enviar 3 tipos de correos: Confirmación de reserva, Cancelación e Invitación a la organización. Usa HTML simple con estilos inline."
3. **Prompt - Hooks de envío:** "Integra el servicio de email en los controladores de Bookings y Auth. Asegúrate de que el envío sea 'fire and forget' para no bloquear la respuesta al usuario."

---

### FASE 4: PRIVACIDAD (GDPR Ready)

*Control total para el usuario.*

1. **Prompt - Consentimiento:** "Añade un campo `privacy_consent` (JSONB) a los usuarios. Crea un banner de cookies en el frontend que guarde la preferencia en `localStorage` y la sincronice con la DB."
2. **Prompt - Portabilidad:** "Crea un endpoint `/api/users/export` que genere un JSON descargable con TODA la información del usuario (perfil, reservas, logs)."
3. **Prompt - Derecho al Olvido:** "Implementa la eliminación de cuenta: debe anonimizar el email y nombre del usuario, pero mantener los registros de reservas para integridad contable de la organización."

---
